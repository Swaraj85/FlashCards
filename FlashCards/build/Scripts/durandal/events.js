define(["durandal/system"],function(e){var n=/\s+/,t=function(){},i=function(e,n){this.owner=e,this.events=n};return i.prototype.then=function(e,n){return this.callback=e||this.callback,this.context=n||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},i.prototype.on=i.prototype.then,i.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},t.prototype.on=function(e,t,a){var r,o,s;if(t){for(r=this.callbacks||(this.callbacks={}),e=e.split(n);o=e.shift();)s=r[o]||(r[o]=[]),s.push(t,a);return this}return new i(this,e)},t.prototype.off=function(t,i,a){var r,o,s,u;if(!(o=this.callbacks))return this;if(!(t||i||a))return delete this.callbacks,this;for(t=t?t.split(n):e.keys(o);r=t.shift();)if((s=o[r])&&(i||a))for(u=s.length-2;u>=0;u-=2)i&&s[u]!==i||a&&s[u+1]!==a||s.splice(u,2);else delete o[r];return this},t.prototype.trigger=function(e){var t,i,a,r,o,s,u,c;if(!(i=this.callbacks))return this;for(c=[],e=e.split(n),r=1,o=arguments.length;o>r;r++)c[r-1]=arguments[r];for(;t=e.shift();){if((u=i.all)&&(u=u.slice()),(a=i[t])&&(a=a.slice()),a)for(r=0,o=a.length;o>r;r+=2)a[r].apply(a[r+1]||this,c);if(u)for(s=[t].concat(c),r=0,o=u.length;o>r;r+=2)u[r].apply(u[r+1]||this,s)}return this},t.prototype.proxy=function(e){var n=this;return function(t){n.trigger(e,t)}},t.includeIn=function(e){e.on=t.prototype.on,e.off=t.prototype.off,e.trigger=t.prototype.trigger,e.proxy=t.prototype.proxy},t});